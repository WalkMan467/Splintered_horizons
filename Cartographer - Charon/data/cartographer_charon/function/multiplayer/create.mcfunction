execute if score @s ca.boons matches 1.. run data modify storage cartographer_charon:bundle bundle.components.minecraft:custom_data.DeathBundleContents set value []

summon item_display ~0.5 ~0.7 ~0.5 {Tags:["ca.charon_shade_item_display"],Passengers:[{id:"minecraft:interaction",width:0.6f,height:1.25f,Tags:["ca.charon_shade_interaction"]},{id:"minecraft:sheep",Tags:["ca.charon_shade_health_checker"],active_effects:[{id:"minecraft:invisibility",amplifier:0,duration:20000000,show_particles:0b},{id:"minecraft:resistance",amplifier:4,duration:20000000,show_particles:0b}],Silent:1b,DeathLootTable:"no",Health:10.0f,attributes:[{id:"minecraft:max_health",base:30},{id:"minecraft:scale",base:0.0625}],Passengers:[{id:"minecraft:allay",Silent:1b,Invulnerable:1b,Glowing:1b,CustomNameVisible:1b,Team:"CharonCageVisual",PersistenceRequired:1b,NoAI:1b,Health:20f,Tags:["charon.multiplayer_shade","new"],CustomName:{"translate":"cartographer.charon.shade.interaction.name","fallback":"Fallen Player","color":"aqua","italic":false},attributes:[{id:"minecraft:max_health",base:40}],Passengers:[{id:"text_display",Tags:["ca.charon_shade_text"],text:{"translate":"cartographer.charon.shade.interaction.tutorial","fallback":"Hold [%s] to\\nrevive this player!","color":"white","italic":false,"with":[{"keybind":"key.use","color":"aqua","italic":false}]},background: 0,billboard:"vertical",line_width:220,interpolation_duration:0,start_interpolation:0,transformation:[0.700f, 0.000f, 0.000f,0.000f,0.000f, 0.700f, 0.000f,-1.100f,0.000f, 0.000f, 0.700f,0.000f,0.000f, 0.000f, 0.000f,1.000f],brightness:{sky:15,block:15}}]}]}]}

scoreboard players add $shades_active dt.var 1

#data modify storage gu:main out set value "-"
#execute as @p[tag=the_one_dying] run function gu:generate
#data modify storage cartographer:charon player set from storage gu:main out

execute as @e[type=allay,distance=..1.5,sort=nearest,tag=charon.multiplayer_shade,tag=new] at @s run function cartographer_charon:multiplayer/fill with storage cartographer:charon